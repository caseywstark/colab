{% load threadedcommentstags %}
{% load i18n %}
{% load uni_form_tags %}
{% load pagination_tags %}
{% load avatar_tags %}
{% load markup_tags %}
{% load sorting_tags %}
{% load issues_tags %}

{#{% get_threaded_comment_tree for post as comments %}#}
{#{% get_comment_count for post as comment_count %}#}

{% autosort comments %}
{% autopaginate comments %}

<div class="comments-wrapper">
    <div class="section">
        <div class="list-title-wrapper">
            <div class="list-title">
                Comments
                <span>({{ comment_count }})</span>
            </div>
            
            <ul class="list-sorting">
                <li>Sort:</li>
                <li>{% anchor created "by date" %}</li>
                <li>{% anchor yeas "by yeas" %}</li>
                <li>{% anchor nays "by nays" %}</li>
            </ul>
            <div class="clear"></div>
        </div>
        
        <div class="section-content">
            <ul class="post-list comments">
                {% if comments %}
                    {% for comment in comments %}
                    <li id="issue-{{ post.id }}-comment-{{ comment.id }}" class="list-item comment level-{{ comment.depth }}">
                        {% post_meta comment %}
                        
                        <div class="post-content">
                            {{ comment.comment|safe }}
                        </div>
                        <div class="clear"></div>
                        
                        <ul class="post-buttons">
                            {% ifequal comment.user user %}
                                <li><a id="edit-{{ comment.id }}-link" class="post-option" href="">Edit</a></li>
                                <li><a class="post-option" href="">Delete</a></li>
                            {% endifequal %}
                            <li><a id="reply-{{ comment.id }}-link" class="post-option" href="">Reply</a></li>
                        </ul>
                        <div class="clear"></div>
                    </li>
                    {% endfor %}
                {% else %}
                    <li>No comments yet</li>
                {% endif %}
            </ul>

            {% paginate %}
            
        </div>
    </div>
</div>
