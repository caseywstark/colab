{% load i18n %}
{% load ifsetting_tag %}
{% load openid_tags %}

{% load uni_form_tags %}
{% load account_tags %}
{% load avatar_tags %}
{% load theme_tags %}

<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>{% if SITE_NAME %}{{ SITE_NAME }} | {% endif %}{% block head_title %}{% endblock %}</title>
        
        <meta name="robots" content="index, follow, noodp" />
        <meta name="description" content="Open Source Science" />
        <meta name="keywords" content="CoLab, Science, Lab, Physics, Math, Debate, Publications, Papers" />
        <meta name="author" content="Casey Stark" />
        
        <link rel="icon" type="image/x-icon" href="{{ STATIC_URL }}images/favicon.ico" />
        
        <link rel="stylesheet" href="{{ STATIC_URL }}css/reset.css" />
        <!-- Testing without uni-form CSS - we should have our own form styles
        <link rel="stylesheet" href="{{ STATIC_URL }}uni_form/uni-form.css" />
        -->
        <link rel="stylesheet" href="{{ STATIC_URL }}js/autocomplete/jquery.autocomplete.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}css/style_new.css" />
        
        <script src="{{ STATIC_URL }}js/jquery.js" type="text/javascript"></script>
        <script src="{{ STATIC_URL }}js/jquery.slug.js" type="text/javascript"></script>
        <script src="{{ STATIC_URL }}js/autocomplete/jquery.autocomplete.js" type="text/javascript"></script>
        <script src="{{ STATIC_URL }}uni_form/uni-form.jquery.js" type="text/javascript"></script>
        <script src="{{ STATIC_URL }}pinax/js/base.js" type="text/javascript"></script>
        <script src="{{ STATIC_URL }}mathjax/MathJax.js" type="text/javascript">
            MathJax.Hub.Config({
                extensions: ["tex2jax.js","TeX/noErrors.js"],
                jax: ["input/TeX","output/HTML-CSS"],
                tex2jax: {inlineMath: [['$','$'],["\\(","\\)"]]},
                "HTML-CSS": {availableFonts:["TeX"]}
            });
        </script>
        
        {% block head_extra %}{% endblock %}
    </head>
    
    <body class="{% block body_class %}{% endblock %}">
        
        <div id="feedback-widget-wrapper">
            <a id="feedback-widget-toggle" href="{% url feedback_submit %}">Feedback</a>
            <div id="feedback-widget">
                {% if not request.user.is_authenticated %}
                    <p><strong>We allow anonymous feedback, but it's much better to login in before submitting feedback so we can respond to you.</strong></p>
                {% endif %}
                <form class="uniForm" id="feedback_widget_form" method="POST" action="{# {% url feedback_form %} #}">
                    <fieldset class="inlineLabels">
                        {{ widget_feedback_form|as_uni_form }}
                        <div class="form_block">
                            <input type="submit" value="Submit Feedback"/>
                        </div>
                    </fieldset>
                </form>
            </div>
            
            <script type="text/javascript">
                $(document).ready(function() {
                    $("#feedback-widget-toggle").click(function() {
                        $("#feedback-widget").slideToggle(500);
                        return false;
                    });
                });
            </script>
        </div>
        
        <div class="guide">
            <div id="logo-wrapper">
                <a id="logo-link" href="{% url home %}">
                    <img id="logo-img" src="{{ STATIC_URL }}images/logo.png" alt="CoLab">
                </a>
            </div>
            
            <div id="top-navigation-wrapper">
                <ul id="top-navigation">
                    <li id="tab_home"><a href="{% url home %}">Home</a></li>
                    <li id="tab_about"><a href="{% url about %}">About</a></li>
                    <li id="tab_faqs"><a href="{% url faq %}">FAQs</a></li>
                    <li id="tab_contact"><a href="{% url contact %}">Contact</a></li>
                    <li id="tab_contribute"><a href="{% url contribute %}">{% silk "coins" %} Contribute</a></li>
                </ul>
                <div class="clear"></div>
            </div>
            
            <!--
            <div id="oss">Open Source Science</div>
            -->
            
            {% if user.is_authenticated %}
                <div id="user-box">
                    <a id="my-avatar" href="{% url avatar_change %}">
                        {% avatar user 60 %}
                    </a>
                    {% url researcher_detail user as profile_url %}
                    <div id="user-details">
                        <a id="my-name" href="{{ profile_url }}">{% user_display user %}</a>
                        <div id="user-navigation">
                            <a href="{{ profile_url }}">{% silk "user" %} {% trans "Profile" %}</a> | 
                            <a href="{% url acct_email %}">{% silk "cog" %} {% trans "Settings" %}</a> | 
                            <a href="/openid/logout/?next={% url acct_logout %}">{% silk "world_go" %} {% trans "Logout" %}</a>
                            {% if user.is_staff %}
                                <br><a href="/admin/">{% silk "server_database" %} {% trans "Admin" %}</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div id="login-box">
                        <a href="{% url acct_login %}">{% silk "world_go" %} {% trans "Login" %}</a>
                    {% ifsetting ACCOUNT_OPEN_SIGNUP %}
                        {% trans "or" %}
                        <a href="{% url acct_signup %}"><b>{% silk "key" %} {% trans "Sign up" %}</b></a>
                    {% endifsetting %}
                </div>
            {% endif %}
            <div class="clear"></div>
                
            {% if site_wide_announcements %}
                <div id="site_wide_announcements">
                    <ul>
                        {% for announcement in site_wide_announcements %}
                        <li>
                            <a href="{{ announcement.get_absolute_url }}">{{ announcement }}</a> -
                            <a href="{% url announcement_hide announcement.pk %}?next={{ request.path }}">{% trans "Hide announcement" %}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            
            {% if messages %}
                <ul id="messages">
                    {% for message in messages %}
                    <li id="message_{{ forloop.counter }}"{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                        <a href="#"><small>{% trans "clear" %}</small></a>
                        {{ message }}
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
            
            <!--
            <div id="beta"><a href="{% url about %}">Prototype Version!</a></div>
            -->
            
            <div id="content-navigation-wrapper">
                <ul id="content-navigation">
                    {% block extra_tab %}{% endblock %}
                    {% if user.is_authenticated %}
                        <li id="tab_hq"><a href="{% url headquarters %}">{% trans "Headquarters" %}</a></li>
                    {% endif %}
                    <li id="tab_issues"><a href="{% url issue_list %}">{% trans "Issues" %}</a></li>
                    <li id="tab_people"><a href="{% url researcher_list %}">{% trans "People" %}</a></li>
                    <li id="tab_blog"><a href="/blog/">{% trans "The Blog" %}</a></li>
                    <li id="tab_feedback"><a href="{% url feedback_list %}">{% trans "Feedback" %}</a></li>
                </ul>
            </div>
            <div class="clear"></div>
            
            <div id="page-content">
                <div id="subnav-wrapper">
                    <ul id="breadcrumbs">
                        {% block breadcrumbs %}{% endblock %}
                    </ul>
                    
                    <ul id="subnav">
                        {% block subnav %}{% endblock %}
                    </ul>
                    <div class="clear"></div>
                </div>
                <div id="actions">
                    <ul id="action-list">
                        {% block actions %}{% endblock %}
                    </ul>
                    <div class="clear"></div>
                </div>
                <div id="body">
                    {% block body %}{% endblock body %}
                </div>
            </div>
                
            <div id="footer">
                <div id="copyright">
                        &copy; 2010 Casey Stark (<a href="http://www.thestarkeffect.com/">The Stark Effect</a>)
                </div>
                
                <div id="powered-by">
                    Powered by <a href="http://www.pinaxproject.com/">Pinax</a>,
                <div id="django-badge">
                    <a href="http://www.djangoproject.com/"><img src="http://media.djangoproject.com/img/badges/djangomade124x25.gif" border="0" alt="Made with Django." title="Made with Django." /></a>
                </div>
                , and
                <div id="jquery-badge">
                    <a href='http://jquery.com/' title='jQuery JavaScript Library'><img src='http://jquery.com/files/buttons/110x31_gr01.png' alt='jQuery JavaScript Library' title='jQuery JavaScript Library' style='border:none;'/></a>
                </div>
                . Hosted by
                <div id="webfaction-badge">
                    <a href="http://www.webfaction.com/">
                        <img src="http://www.webfaction.com/banners/80x15-bg.png" border="0" alt="Webfaction." title="Webfaction" />
                    </a>
                </div>
                <div class="clear"></div>
            </div>
        
        </div>
        {% block extra_body_base %}
            {% block extra_body %}{% endblock %}
        {% endblock %}
        <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
        <script type="text/javascript">
            try {
                var pageTracker = _gat._getTracker("UA-15446482-1");
                pageTracker._trackPageview();
            }
            catch(err) {}
        </script>
    </body>
</html>
